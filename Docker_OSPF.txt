DockerとFRRを使ってOSPFの勉強をするための検証用の5台分のコンテナを構成するDocker Composeの設定ファイルを作成

FRRを利用するためのDockerイメージを作成し、5台分のネットワークを構成するためのDocker Composeファイルを作成

OSPFの設定を行うため、DockerコンテナにはFRRがインストールされている必要がある

1. Docker Composeファイル例
version: '3.8'

services:
  r1:
    image: frrouting/frr:latest
    container_name: r1
    networks:
      net:
        ipv4_address: 192.168.1.1
    cap_add:
      - NET_ADMIN
    volumes:
      - ./config/r1:/etc/frr
    command: /bin/bash -c "service frr start; tail -f /dev/null"

  r2:
    image: frrouting/frr:latest
    container_name: r2
    networks:
      net:
        ipv4_address: 192.168.1.2
    cap_add:
      - NET_ADMIN
    volumes:
      - ./config/r2:/etc/frr
    command: /bin/bash -c "service frr start; tail -f /dev/null"

  r3:
    image: frrouting/frr:latest
    container_name: r3
    networks:
      net:
        ipv4_address: 192.168.1.3
    cap_add:
      - NET_ADMIN
    volumes:
      - ./config/r3:/etc/frr
    command: /bin/bash -c "service frr start; tail -f /dev/null"

  r4:
    image: frrouting/frr:latest
    container_name: r4
    networks:
      net:
        ipv4_address: 192.168.1.4
    cap_add:
      - NET_ADMIN
    volumes:
      - ./config/r4:/etc/frr
    command: /bin/bash -c "service frr start; tail -f /dev/null"

  r5:
    image: frrouting/frr:latest
    container_name: r5
    networks:
      net:
        ipv4_address: 192.168.1.5
    cap_add:
      - NET_ADMIN
    volumes:
      - ./config/r5:/etc/frr
    command: /bin/bash -c "service frr start; tail -f /dev/null"

networks:
  net:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.1.0/24
2. 各コンテナの設定
FRRの設定は各コンテナ内に保存される./config/rXディレクトリ（r1, r2, r3, r4, r5）に配置します。
ネットワーク設定：
各コンテナに個別のIPアドレス（192.168.1.1から192.168.1.5まで）を割り当てる。
各コンテナは同じネットワークnetに接続される
3. OSPF設定ファイルの例
次に、各コンテナでOSPFを設定するために必要なfrr.conf（FRRの設定ファイル）を準備する。

例: r1のOSPF設定（./config/r1/frr.conf）

frr version 7.5
frr defaults traditional
hostname r1
log syslog informational

router ospf
 ospf router-id 1.1.1.1
 network 192.168.1.0/24 area 0.0.0.0
例: r2のOSPF設定（./config/r2/frr.conf）

frr version 7.5
frr defaults traditional
hostname r2
log syslog informational

router ospf
 ospf router-id 2.2.2.2
 network 192.168.1.0/24 area 0.0.0.0
同様に、r3, r4, r5にもそれぞれ異なるrouter-idと適切なnetwork設定を行う。

4. 設定後の手順
Docker Composeでコンテナを起動:
docker-compose up -d
各コンテナにログイン:
docker exec -it r1 bash
FRRサービスを開始: 各コンテナでFRRサービスを手動で開始するか、Dockerコンテナの起動時に自動的に開始するように設定している（command: /bin/bash -c "service frr start; tail -f /dev/null"）。
OSPFが正しく動作しているか確認: OSPFが正しく動作しているかを確認するには、以下のコマンドを使用する
show ip ospf neighbor
show ip ospf
この構成で、5台のルータ間でOSPFを動作させることができる。各ルータでOSPFを設定し、隣接関係が確立されていることを確認できる
